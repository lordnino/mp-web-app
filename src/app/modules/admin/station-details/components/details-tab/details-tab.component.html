<div class="charging-points-card">
    <div class="charging-points-header">Charging Points & Connectors</div>
</div>
<div *ngFor="let point of charging_points; let index = index" class="charging-points-card">
    <div class="charging-point-block">
        <div class="charging-point-header">
            <mat-icon class="point-icon">local_gas_station</mat-icon>
            <span class="point-title">Charging Point {{ index + 1 }}</span>
            <span class="point-status" [ngClass]="{
                'available': point.is_active && point.status === 'Available',
                'inuse': point.is_active && (point.status === 'InUse' || point.status === 'In Use'),
                'unavailable': point.is_active && point.status === 'Unavailable',
                'disabled': !point.is_active
            }">{{
                !point.is_active ? 'Disabled' : point.status
            }}</span>
            <span class="point-id">#{{ point.id }}</span>
            <!-- Dropdown menu for charging point actions -->
            <button mat-icon-button class="point-menu" [matMenuTriggerFor]="pointMenu">
                <mat-icon>more_vert</mat-icon>
            </button>
            <mat-menu #pointMenu="matMenu">
                <!-- Enable/Disable action based on current status -->
                <button mat-menu-item (click)="toggleChargingPointStatus(point)">
                    <mat-icon [color]="point.is_active ? 'warn' : 'primary'">
                        {{ point.is_active ? 'block' : 'check_circle' }}
                    </mat-icon>
                    <span>{{ point.is_active ? 'Disable' : 'Enable' }} Charging Point</span>
                </button>
                <!-- Move to Another Station action -->
                <button mat-menu-item (click)="moveChargingPointToStation(point)">
                    <mat-icon color="primary">swap_horiz</mat-icon>
                    <span>Move to Another Station</span>
                </button>
            </mat-menu>
        </div>
        <div class="point-info-row">
            <span class="info-item"
                ><img
                    src="megaplug/station/details/check.svg"
                    class="h-[19px] w-[19px]"
                    alt="uptime"
                />
                Uptime : {{ point.uptime ? point.uptime : 'N/A' }}</span
            >
            <span class="info-item"
                ><img
                    src="megaplug/station/details/close.svg"
                    class="h-[19px] w-[19px]"
                    alt="downtime"
                />
                failure rate : {{ point.failureRate ? point.failureRate : 'N/A' }}</span
            >
            <span class="info-item"
                ><img
                    src="megaplug/station/details/serial.svg"
                    class="h-[19px] w-[28px]"
                    alt="serial"
                />
                Serial : {{ point.serial_number ? point.serial_number : 'N/A' }}</span
            >
            <span class="info-item"
                ><img
                    src="megaplug/station/details/fast-charge.svg"
                    class="h-[19px] w-[19px]"
                    alt="fast-charge"
                />
                Type : {{ point.is_dc ? 'DC' : 'AC' }}</span
            >
            <span class="info-item"
                ><img
                    src="megaplug/station/details/firmware.svg"
                    class="h-[19px] w-[19px]"
                    alt="firmware"
                />
                firmware : {{ point.firmware_version ? point.firmware_version : 'N/A' }}</span
            >
            <span class="info-item"
                ><img
                    src="megaplug/station/details/model.svg"
                    class="h-[19px] w-[19px]"
                    alt="model"
                />
                model : {{ point.model ? point.model : 'N/A' }}</span
            >
            <span class="info-item"
                ><img
                    src="megaplug/station/details/vendor.svg"
                    class="h-[19px] w-[19px]"
                    alt="vendor"
                />
                Vendor : {{ point.vendor ? point.vendor : 'N/A' }}</span
            >
        </div>
        <div class="connectors-title">Connectors</div>
        <div class="connectors-row">
            <div
                *ngFor="let connector of point.connectors; let connectorIndex = index"
                class="connector-card"
            >
                <div class="connector-header">
                    <span class="connector-title">Connector {{ connectorIndex + 1 }} / {{ connector.connector_type.name_en }}</span>
                    <button mat-icon-button class="connector-menu">
                        <mat-icon>more_vert</mat-icon>
                    </button>
                </div>
                <div class="connector-info">
                    <span class="connector-id">ID: #{{ connector.id }}</span>
                    <mat-icon class="connector-power-icon">bolt</mat-icon>
                    <span class="connector-power">{{ connector.charge_power.name_en }}</span>
                </div>
                <div class="connector-status" [ngClass]="connector.status.replace(' ', '').toLowerCase()">
                    {{ connector.status }}
                </div>
                <img
                    [src]="connector.connector_type.image"
                    class="connector-img"
                    alt="connector"
                />
            </div>
        </div>
    </div>
</div>

<div class="location-card">
  <div class="location-title">Location</div>
  <div class="location-map-wrapper">
    <google-map
      [height]="'220px'"
      [width]="'100%'"
      [center]="center"
      [zoom]="zoom"
      [options]="{ disableDefaultUI: true, draggable: false, scrollwheel: false, styles: [ { featureType: 'poi', stylers: [ { visibility: 'off' } ] } ] }"
    >
      <map-marker *ngFor="let marker of markers" [position]="marker.position" [icon]="marker.icon"></map-marker>
      <map-circle
        *ngIf="center.lat && center.lng"
        [center]="center"
        [radius]="300"
        [options]="{
          strokeColor: '#00C896',
          strokeOpacity: 0.7,
          strokeWeight: 2,
          fillColor: '#00C896',
          fillOpacity: 0.10
        }"
      ></map-circle>
    </google-map>
  </div>
</div>