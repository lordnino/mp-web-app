<div class="stations-page-layout">
    <!-- Filters bar (full width) -->
    <div class="stations-filters-bar">
        <mat-form-field appearance="outline" floatLabel="always">
            <mat-label>Station Name</mat-label>
            <input
                matInput
                placeholder="Search Station Name"
                [(ngModel)]="filterName"
            />
        </mat-form-field>
        <mat-form-field appearance="outline" floatLabel="always">
            <mat-label>Station Availability</mat-label>
            <mat-select [(ngModel)]="filterAvailability">
                <mat-option value="">Select Availability</mat-option>
                <mat-option value="Available">Available</mat-option>
                <mat-option value="InUse">In use</mat-option>
                <mat-option value="Unavailable">Unavailable</mat-option>
            </mat-select>
        </mat-form-field>
        <mat-form-field appearance="outline" floatLabel="always">
            <mat-label>Connector Type</mat-label>
            <mat-select [(ngModel)]="filterConnectorType">
                <mat-option value="">Select Connector Type</mat-option>
                <!-- Populate dynamically if needed -->
            </mat-select>
        </mat-form-field>
        <mat-form-field appearance="outline" floatLabel="always">
            <mat-label>Charge Power</mat-label>
            <mat-select [(ngModel)]="filterChargePower">
                <mat-option value="">Select Charge Power</mat-option>
                <!-- Populate dynamically if needed -->
            </mat-select>
        </mat-form-field>
        <button mat-flat-button color="primary" class="filter-btn">
            Filter Stations
        </button>
    </div>
        <!-- Main content: station list + map -->
    <div class="stations-main-content bg-[#FCFBFB]">
      <!-- Floating Toggle Button -->
      <div class="floating-toggle-btn" (click)="toggleStationPanel()">
        <i class="toggle-icon" [class.expanded]="!isStationPanelCollapsed">
          {{ isStationPanelCollapsed ? '←' : '→' }}
        </i>
      </div>
      
      <!-- Total Stations Display -->
      @if (markers) {
        <div class="d-flex flex-col gap-3 px-10 py-5 station-right-panel" [class.collapsed]="isStationPanelCollapsed">
                <div class="total-stations-display px-4 py-2">
                    <div class="total-stations-info">
                        <span class="total-label">Total Stations</span>
                        <span class="total-count"
                            >{{ markers.length }} Station{{
                                markers.length !== 1 ? 's' : ''
                            }}</span
                        >
                    </div>
                </div>
                <div class="stations-list-panel">
                    <div class="stations-list">
                        @for (station of markers; track station.id) {
                            <app-station-card
                                [station]="station"
                                [selected]="
                                    selectedStation &&
                                    selectedStation.id === station.id
                                "
                                (cardClick)="onStationCardClick($event)"
                            ></app-station-card>
                        }
                    </div>
                </div>
            </div>
        }

            <div class="stations-map-panel">
      <div class="map-wrapper">
        <google-map
          [height]="'100%'"
          [width]="'100%'"
          [center]="center"
          [zoom]="zoom"
        >
          @for (marker of markers; track marker.position) {
            <map-marker
              [position]="marker.position"
              [icon]="marker.icon"
              (mapClick)="onMarkerClick(marker)"
            ></map-marker>
          }
        </google-map>
      </div>
      
      <!-- Add New Station Button -->
      <div class="add-station-btn" (click)="onAddNewStation()">
        <div class="add-station-icon">
         <img src="megaplug/station-list/add-station-icon.svg" alt="">
        </div>
        <span class="add-station-text whitespace-nowrap">Add New Station</span>
      </div>
    </div>
        <!-- Drawer remains as is -->
    </div>
    <div class="station-drawer" [class.open]="drawerOpen">
        <div class="station-drawer-header">
            <span class="quick-view-title">Quick View</span>
            <button class="close-btn" (click)="drawerOpen = false">
                ×
            </button>
        </div>
        @if (selectedStation) {
            <div class="station-quick-view">
                <!-- Station Image -->
                <div class="station-image-wrapper">
                    @if (selectedStation.image) {
                        <img
                            class="station-image"
                            [src]="selectedStation.image"
                            alt="Station Image"
                        />
                    } @else {
                        <img
                            class="station-image"
                            src="/megaplug/ev-station-placeholder.svg"
                            alt="Station Image"
                        />
                    }
                    <span
                        class="station-status"
                        [class.available]="
                            selectedStation.status.toLowerCase() ===
                            'available'
                        "
                        [class.inuse]="
                            selectedStation.status.toLowerCase() === 'inuse'
                        "
                        [class.unavailable]="
                            selectedStation.status.toLowerCase() ===
                            'unavailable'
                        "
                    >
                        {{
                            selectedStation.status === 'Available'
                                ? 'Available'
                                : selectedStation.status === 'InUse'
                                  ? 'In Use'
                                  : 'Unavailable'
                        }}
                    </span>
                </div>
                <!-- Station Name & Address -->
                <div class="station-header">
                    <h2>
                        {{
                            selectedStation.name_en ||
                                selectedStation.name_ar ||
                                selectedStation.label
                        }}
                    </h2>
                    <div class="station-address">
                        {{
                            selectedStation.address_en ||
                                selectedStation.address_ar
                        }}
                    </div>
                    <div class="station-rating mt-3">
                        <span class="star">
                            <img
                                src="/megaplug/icons/star-bold.svg"
                                alt="Star"
                            />
                        </span>
                        4.9
                    </div>
                </div>
                <!-- Divider -->
                <div class="station-divider"></div>
                <!-- Station Information Title -->
                <div>
                    <div class="section-title">Station Information</div>
                    <!-- Station Information -->
                    <div class="station-info">
                        <div class="flex items-center gap-2">
                            <img src="megaplug/station-list/watt-green.svg" class="w-[18px] h-[18px]" alt="Connectors" />
                            <span class="text-[#64758B] font-regular whitespace-nowrap">
                                {{
                                    getConnectorCount(selectedStation)
                                }}
                                connectors
                            </span>
                        </div>
                        <div class="flex items-center gap-2">
                            <img src="megaplug/station-list/fast-charge-yellow.svg" class="w-[18px] h-[18px]" alt="Power" />
                            <span class="text-[#64758B] font-regular whitespace-nowrap">
                                {{ getPowerRange(selectedStation) }}
                            </span>
                        </div>
                    </div>
                </div>
                <!-- Divider -->
                <div class="station-divider"></div>
                <!-- Connector Types -->
                <div class="connector-types">
                    <div class="section-title">Connector Type</div>
                    <ul>
                        @for (
                            type of getConnectorTypes(selectedStation);
                            track type.name
                        ) {
                            <li>
                                <img
                                    [src]="type.icon"
                                    alt="{{ type.name }}"
                                    class="connector-icon"
                                />
                                {{ type.name }}
                            </li>
                        }
                    </ul>
                </div>
                <!-- Charge Power -->
                <div class="charge-power">
                    <div class="section-title">Charge Power</div>
                    <div class="power-list">
                        @for (
                            power of getChargePowers(selectedStation);
                            track power
                        ) {
                            <span class="power-badge flex items-center gap-2"
                                ><img src="megaplug/station-list/watt-light-grey.svg" class="w-[13px] h-[13px]" alt="watt" />  
                                <span>
                                    {{ power }} KW
                                </span>
                            </span>
                        }
                    </div>
                </div>
                <!-- Details Button -->
                <button class="station-details-btn flex justify-center items-center gap-2" (click)="onStationDetailsClick()">
                    <img src="megaplug/station-list/station-details.svg" class="w-[18px] h-[16px]" alt="Station Details" />
                    <span class="whitespace-nowrap">Station Details</span>
                </button>
            </div>
        }
    </div>
</div>
