<div class="flex min-w-0 flex-auto flex-col">
    <app-page-header
        [breadcrumbs]="[
            { name: 'Customers', link: '/customers/all-customers' },
        ]"
        [title]="'Customers'"
    >
    </app-page-header>

    <div class="flex-auto p-6 sm:p-10">
        <!-- Filter Form -->
        <form class="mb-6 flex flex-col gap-4 p-6 bg-card rounded-xl shadow-sm" [formGroup]="filterForm">
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                <mat-form-field appearance="outline">
                    <mat-label>Name</mat-label>
                    <input matInput formControlName="name" placeholder="Search by name" />
                    <mat-icon matPrefix class="text-gray-400">search</mat-icon>
                </mat-form-field>
                <mat-form-field appearance="outline">
                    <mat-label>Email</mat-label>
                    <input matInput formControlName="email" placeholder="Search by email" />
                    <mat-icon matPrefix class="text-gray-400">email</mat-icon>
                </mat-form-field>
                <mat-form-field appearance="outline">
                    <mat-label>Phone</mat-label>
                    <input matInput formControlName="phone" placeholder="Search by phone" />
                    <mat-icon matPrefix class="text-gray-400">phone</mat-icon>
                </mat-form-field>
                <mat-form-field appearance="outline">
                    <mat-label>Active Status</mat-label>
                    <mat-select formControlName="is_active">
                        <mat-option [value]="null">All</mat-option>
                        <mat-option [value]="1">Active</mat-option>
                        <mat-option [value]="0">Inactive</mat-option>
                    </mat-select>
                    <mat-icon matPrefix class="text-gray-400">toggle_on</mat-icon>
                </mat-form-field>
            </div>
            <div class="flex gap-2 justify-end">
                <button 
                    mat-flat-button 
                    type="button" 
                    (click)="onFilter()" 
                    class="bg-primary text-white">
                    <mat-icon class="mr-1">filter_list</mat-icon>
                    Filter
                </button>
                <button 
                    mat-stroked-button 
                    type="button" 
                    (click)="onResetFilters()" 
                    [disabled]="!hasActiveFilters">
                    Reset
                </button>
            </div>
        </form>

        <div class="bg-card flex flex-col rounded-2xl shadow">
            @if(loading && customers.length === 0) {
                <div class="flex items-center justify-center h-64">
                    <mat-spinner diameter="40"></mat-spinner>
                </div>
            } @else if(customers.length === 0) {
                <div class="flex flex-col items-center justify-center h-64 text-gray-500">
                    <mat-icon class="text-6xl mb-4">people_outline</mat-icon>
                    <p class="text-xl font-medium">No customers found</p>
                    <p class="text-sm mt-2">Try adjusting your filters or check back later</p>
                </div>
            } @else {
                <app-data-table
                    [data]="customers"
                    [columns]="columns"
                    [loading]="loading"
                    [actions]="tableActions"
                    (sortChange)="onSortChange($event)"
                    (actionClick)="onActionClick($event)"
                    [sortActive]="sortActive"
                    [sortDirection]="sortDirection"
                    class="w-full"
                >
                    <ng-template #avatarTemplate let-row>
                        @if (row.avatar) {
                            <div class="flex items-center">
                                <img 
                                    [src]="row.avatar" 
                                    [alt]="row.name + ' avatar'"
                                    class="w-10 h-10 rounded-full object-cover border-2 border-gray-200"
                                    (error)="onAvatarError($event)"
                                >
                            </div>
                        } @else {
                            <div class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center">
                                <mat-icon class="text-gray-500 text-lg">person</mat-icon>
                            </div>
                        }
                    </ng-template>

                    <ng-template #statusTemplate let-row>
                        @if (row.is_active !== null && row.is_active !== undefined) {
                            <mat-chip 
                                [class]="(row.is_active === 1 || row.is_active === true) ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'"
                                class="font-medium">
                                {{ (row.is_active === 1 || row.is_active === true) ? 'Active' : 'Inactive' }}
                            </mat-chip>
                        } @else {
                            <span class="text-gray-500">-</span>
                        }
                    </ng-template>

                    <ng-template #actionsTemplate let-row>
                        <button mat-icon-button [matMenuTriggerFor]="menu">
                            <mat-icon>more_vert</mat-icon>
                        </button>
                        <mat-menu #menu="matMenu">
                            @for (action of tableActions; track action.action) {
                                @if (!action.show || action.show(row)) {
                                    <button mat-menu-item (click)="onActionClick(action, row)">
                                        <mat-icon>{{ action.icon }}</mat-icon>
                                        <span>{{ action.label }}</span>
                                    </button>
                                }
                            }
                        </mat-menu>
                    </ng-template>
                </app-data-table>

                @if (customersMeta?.total > 0) {
                    <div class="w-full flex justify-center p-4 border-t">
                        <app-pagination
                            [meta]="customersMeta"
                            (pageChange)="pageChanger($event)"
                            (pageSizeChange)="onPageSizeChange($event)"
                            [per_page]="params.per_page"
                        ></app-pagination>
                    </div>
                }
            }
        </div>
    </div>
</div>